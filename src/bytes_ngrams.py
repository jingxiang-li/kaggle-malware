from os import path, listdir
from nltk.util import ngrams
from collections import Counter
import pickle
import re


def byte_list_generator(wd='/media/s_ariel/HDD_1T/Kaggle/data/train'):
    files = listdir(wd)
    regex_asm = re.compile('.*\.bytes')
    asm_files = [f for f in files if regex_asm.match(f) is not None]
    asm_files.sort()

    for asm_name in asm_files:
        byte_list = []
        with open(path.join(wd, asm_name), 'r', encoding='latin-1') as f_in:
            for line in f_in:
                byte_list += line.split()[1:]
        yield byte_list

byte_dicts = []

byte_gen = byte_list_generator()
j = 0
for byte_list in byte_gen:
    byte_dicts.append(Counter(byte_list))
    print(Counter(ngrams(byte_list, 3)))
    break
#     j += 1
#     if j == 50:
#         print(j)

# with open('../data/bytes_1gram.pickle', 'wb') as fout:
#     pickle.dump(byte_dicts, fout)
