rm(list = ls())
require(ggplot2)
require(reshape2)
require(pipeR)
require(dplyr)

setwd("~/Malware-Classificatoin/")
source("./src/ggplot_theme.R")

nm = c('NB',
       'Multi-Logreg',
       'OvR-Logreg',
       'LDA',
       'QDA',
       'SVM',
       'RF',
       'ExtraTrees',
       'XGBoost')
logloss_result = read.table("./logloss.csv", header = FALSE)
colnames(logloss_result) = nm

logloss_long = melt(logloss_result)
colnames(logloss_long) = c('Model', 'Logloss')

cairo_pdf("./imgs/logloss.pdf", width = 6, height = 5)
logloss_long %>>%
  ggplot(aes(x = Model, y = Logloss)) +
  geom_boxplot() +
  geom_jitter(width = 0.1, height = 0.1) +
  xlab("Candidate Classifiers") +
  ylab("Logloss Score") +
  theme_Publication() +
  theme(axis.text.x = element_text(
    angle = 20,
    hjust = 0.5,
    vjust = 0.8
  )) +
  scale_y_sqrt()
dev.off()


acc_result = read.table("./roc.csv", header = F)
colnames(acc_result) = nm
acc_long = melt(acc_result)
colnames(acc_long) = c('Model', 'Accuracy')

cairo_pdf("./imgs/acc.pdf", width = 6, height = 5)
acc_long %>>%
  ggplot(aes(x = Model, y = Accuracy)) +
  geom_boxplot() +
  geom_jitter(width = 0.1, height = 0.1) +
  xlab("Candidate Classifiers") +
  ylab("Accuracy Score") +
  theme_Publication() +
  theme(axis.text.x = element_text(
    angle = 20,
    hjust = 0.5,
    vjust = 0.8
  ))
dev.off()

X = read.table("./tsne.csv", header = F)
y = read.table("./y.csv", header = F)
mal_nm = c(
  'Ramnit',
  'Lollipop',
  'Kelihos_ver3',
  'Vundo',
  'Tracur',
  'Kelihos_ver1',
  'Obfuscator.ACY',
  'Gatak'
)
y_labels = as.factor(mal_nm[y[, 1] + 1])
data = data.frame(X, y_labels)
colnames(data) = c('Dim1', 'Dim2', 'Malware Family')

cairo_pdf("./imgs/tsne.pdf", width = 6.4, height = 4.8)
data %>>%
  ggplot(aes(x = Dim1, y = Dim2)) +
  geom_point(aes(color = `Malware Family`), alpha = 0.5) +
  xlab("") +
  ylab("") +
  theme_Publication() +
  scale_colour_Publication() +
  theme(
    legend.position = "right",
    legend.direction = "vertical",
    legend.key.size = unit(0.6, "cm")
  )
dev.off()

for (i in 0:7) {
  filename = paste("./fscore", i, ".csv", sep = '')
  print(filename)
  savename = paste("./imgs/fscore", i, ".pdf", sep = '')
  fscore = read.table(filename, header = F)
  nm = c(
    'NB',
    'Multi-Logreg',
    'OvR-Logreg',
    'LDA',
    'QDA',
    'SVM',
    'RF',
    'ExtraTrees',
    'XGBoost'
  )
  colnames(fscore) = nm
  
  fscore_long = melt(fscore)
  colnames(fscore_long) = c('Model', 'F1-Score')
  
  cairo_pdf(savename, width = 6, height = 6)
  p = ggplot(fscore_long, aes(x = Model, y = `F1-Score`)) +
    geom_boxplot() +
    geom_jitter(width = 0.1, height = 0.1) +
    xlab("Candidate Classifiers") +
    ylab("F1-Score") +
    theme_Publication() +
    theme(axis.text.x = element_text(
      angle = 20,
      hjust = 0.5,
      vjust = 0.8
    ))
  print(p)
  dev.off()
}
