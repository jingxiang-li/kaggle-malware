import re
from os import listdir, path
import pickle
from collections import Counter

wd = '/media/s_ariel/HDD_1T/Kaggle/data/train'

files = listdir(wd)
regex_asm = re.compile('.*\.asm')
asm_files = [f for f in files if regex_asm.match(f) is not None]
asm_files.sort()

regex_op = re.compile(
    r'[\.\w]+:[0-9A-F]{8}\s[0-9A-F]{2}[0-9A-F\s+]*\s(dd|db|dw|align)\s.*')

op_lists = []
i = 0

for asm in asm_files:
    print(asm)
    op_counter = Counter()
    with open(path.join(wd, asm), 'r', encoding='latin-1') as f_in:
        for line in f_in:
            r0 = regex_op.match(line)
            if r0 is not None:
                op_counter[r0.group(1)] += 1
    op_lists.append(op_counter)


save_path = '/home/s_ariel/Documents/other_count.pickle'
with open(save_path, 'wb') as f_out:
    pickle.dump(op_lists, f_out)
