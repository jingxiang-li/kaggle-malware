from os import path
from nltk.util import ngrams, everygrams
from collections import Counter
import pickle


def op_list_generator(wd='/home/s_ariel/Documents'):
    for i in range(22):
        file_name = 'op' + str(i) + '.pickle'
        with open(path.join(wd, file_name), 'rb') as f_in:
            op_lists = pickle.load(f_in)
            for op in op_lists:
                yield op


# first pass, find frequent grams, at least 50 in one asm file
freq_grams = []
op_gen = op_list_generator()
j = 0
for op in op_gen:
    gram_counts = Counter(everygrams(op, min_len=3, max_len=4))
    freq_grams += [k for k, v in gram_counts.items() if v > 99]
    j += 1
    if j % 100 == 0:
        print(j)


wd = '/home/s_ariel/Documents'
with open(path.join(wd, 'freq_gram.pickle'), 'wb') as f_out:
    pickle.dump(set(freq_grams), f_out)
