from os import path
from nltk.util import ngrams, everygrams
from collections import Counter
import pickle


def op_list_generator(wd='/home/s_ariel/Documents'):
    for i in range(22):
        file_name = 'op' + str(i) + '.pickle'
        with open(path.join(wd, file_name), 'rb') as f_in:
            op_lists = pickle.load(f_in)
            for op in op_lists:
                yield op


wd = '/home/s_ariel/Documents'
with open(path.join(wd, 'freq_gram.pickle'), 'rb') as f_in:
    freq_grams = pickle.load(f_in)


# second pass, count frequent grams
op_gen = op_list_generator()
result = []
j = 0
for op in op_gen:
    gram_counts = Counter(everygrams(op, min_len=3, max_len=4))
    freq_gram_counts = {k: v for k,
                        v in gram_counts.items() if k in freq_grams}
    result.append(freq_gram_counts)
    j += 1
    if j % 100 == 0:
        print(j)


wd = '/home/s_ariel/Documents'
with open(path.join(wd, 'gram_count.pickle'), 'wb') as f_out:
    pickle.dump(result, f_out)
