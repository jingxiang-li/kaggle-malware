from skimage.io import imread
from skimage.transform import resize
from os import listdir, path
import re
import numpy as np
import gist
import pickle

wd = '/home/s_ariel/Documents/imgs'
files = listdir(wd)
regex_asm = re.compile('.*\.jpg')
img_files = [f for f in files if regex_asm.match(f) is not None]
img_files.sort()

feature_list = []

for img_file in img_files:
    print(img_file)
    img = imread(path.join(wd, img_file), as_grey=True)
    img = np.uint8(img)
    x = np.array([np.uint8(img), np.uint8(img), np.uint8(img)])
    x = x.swapaxes(0, 1)
    x = x.swapaxes(1, 2)
    f1 = gist.extract(x)[:320]

    thumb = resize(img, (16, 16), preserve_range=True)
    f2 = np.uint8(thumb).flatten()
    feature = np.concatenate((f1, f2))
    feature_list.append(feature)

save_path = '/home/s_ariel/Documents/img_feature.pickle'
with open(save_path, 'wb') as f_out:
    pickle.dump(feature_list, f_out)
